<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iMoon â€¢ Cosmic Meditation</title>
  <!-- Google Font used in original boop site -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.js"></script>
  <style>
    :root{ --accent:#9333ff; }
    html,body{margin:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:'Outfit',sans-serif}
    canvas{position:absolute;inset:0;width:100%;height:100%;display:block}
    /* Orb */
    #orb{position:absolute;left:50%;top:45%;width:260px;height:260px;transform:translate(-50%,-50%);
         border-radius:50%;background:radial-gradient(circle at 35% 30%,#fff 0%,#d7d7ff 38%,#5a5aff 100%);
         box-shadow:0 0 80px #5a5affa0,inset 0 0 25px #ffffff80;animation:float 14s ease-in-out infinite;}
    @keyframes float{0%{transform:translate(-50%,-50%) translateY(-10px);}50%{transform:translate(-50%,-50%) translateY(10px);}100%{transform:translate(-50%,-50%) translateY(-10px);}}
    /* Ring text */
    #ring{position:absolute;left:50%;top:45%;transform-style:preserve-3d;animation:spin 12s linear infinite;}
    @keyframes spin{from{transform:translate(-50%,-50%) rotate(0deg);}to{transform:translate(-50%,-50%) rotate(360deg);}}
    .char{position:absolute;left:0;top:0;color:#fff;font-size:24px;font-weight:700;letter-spacing:4px;transform-origin:130px 0;}
    /* HUD */
    #hud{position:absolute;bottom:24px;left:50%;transform:translateX(-50%);font-size:14px;letter-spacing:0.5px;color:var(--accent);opacity:.8}
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="orb"></div>
  <div id="ring"></div>
  <div id="hud"></div>

<script>
let starDensity=0.0011, accentHue='#9333ff';
fetch('/api/config').then(r=>r.ok?r.json():{}).then(cfg=>{
  if(cfg.star_density) starDensity=Number(cfg.star_density);
  if(cfg.hue) accentHue=cfg.hue;
  document.documentElement.style.setProperty('--accent',accentHue);
  init();
}).catch(init);

function init(){
  // Ring text build
  const ring=document.getElementById('ring');
  const text='PLNT';
  ring.innerHTML='';
  for(let i=0;i<text.length;i++){
    const span=document.createElement('span');
    span.textContent=text[i];
    span.className='char';
    span.style.transform=`rotate(${i*90}deg)`; // 360/4
    ring.appendChild(span);
  }

  // Starfield
  const canvas=document.getElementById('c');
  const ctx=canvas.getContext('2d');
  let stars=[];
  const speedBase=4e-3;
  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;genStars();}
  addEventListener('resize',resize);
  function genStars(){
    const n=Math.floor(canvas.width*canvas.height*starDensity);
    stars=Array.from({length:n}).map(()=>{const a=Math.random()*6.28,s=(Math.random()*.4+.8)*speedBase;
      return{x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.1+.2,tw:Math.random()*360,vx:Math.cos(a)*s,vy:Math.sin(a)*s};});
  }
  let last;
  function draw(t){if(!last)last=t;const dt=t-last;last=t;ctx.fillStyle='#000';ctx.fillRect(0,0,canvas.width,canvas.height);
    for(const s of stars){s.x+=s.vx*dt;s.y+=s.vy*dt;if(s.x<0)s.x+=canvas.width;if(s.x>canvas.width)s.x-=canvas.width;if(s.y<0)s.y+=canvas.height;if(s.y>canvas.height)s.y-=canvas.height;
      ctx.fillStyle=`rgba(255,255,255,${0.5+0.5*Math.sin(t*.002+s.tw)})`;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,6.28);ctx.fill();}
    requestAnimationFrame(draw);}

  // HUD
  const hud=document.getElementById('hud');
  function nextFullMoon(n=new Date()){const syn=29.53059*86400*1e3;const p=SunCalc.getMoonIllumination(n).phase;return new Date(n.getTime()+((p>.5?1.5-p:.5-p)*syn));}
  function hudLoop(){const n=new Date(),f=nextFullMoon(n),s=Math.floor((f-n)/1e3);hud.textContent=`Full moon in ${Math.floor(s/86400)}d ${Math.floor(s%86400/3600)}h ${Math.floor(s%3600/60)}m`;requestAnimationFrame(hudLoop);}

  resize();requestAnimationFrame(draw);hudLoop();
}
</script>
</body>
</html>
